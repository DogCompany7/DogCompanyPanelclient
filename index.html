<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dog Company — Panel de Cliente</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#07090c;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.04);
      --line: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.64);
      --gold: #c7a45a;
      --gold2:#8d6b2f;
      --okbg: rgba(34,197,94,.12);
      --okbd: rgba(34,197,94,.30);
      --oktx: #7CFFB8;
      --pbg: rgba(247,201,72,.12);
      --pbd: rgba(247,201,72,.32);
      --ptx: #FFD27A;
      --shadow: 0 24px 70px rgba(0,0,0,.45);
      --r1: 18px;
      --r2: 22px;
      --max: 1120px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 700px at 18% 0%, rgba(199,164,90,.22), transparent 58%),
        radial-gradient(900px 600px at 92% 12%, rgba(34,197,94,.10), transparent 60%),
        radial-gradient(900px 650px at 50% 120%, rgba(99,102,241,.12), transparent 60%),
        var(--bg);
      min-height:100vh;
    }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 38px 18px 60px;
    }

    /* Top bar */
    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
      margin-bottom: 18px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:14px;
      min-width: 260px;
    }
    .logo{
      width:56px;
      height:56px;
      border-radius: 18px;
      background: linear-gradient(135deg, rgba(199,164,90,.95), rgba(141,107,47,.20));
      box-shadow: 0 18px 45px rgba(199,164,90,.22);
      border: 1px solid rgba(255,255,255,.10);
    }
    .brand h1{
      margin:0;
      font-family: "Playfair Display", serif;
      font-size: 22px;
      font-weight: 700;
      letter-spacing: .4px;
      line-height: 1.1;
    }
    .brand p{
      margin:3px 0 0;
      color: var(--muted);
      font-size: 12.5px;
    }
    .pill{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 12px;
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background: rgba(255,255,255,.35);
    }
    .dot.ok{ background: #22c55e; box-shadow: 0 0 0 3px rgba(34,197,94,.18); }
    .dot.wait{ background: #f7c948; box-shadow: 0 0 0 3px rgba(247,201,72,.18); }
    .dot.err{ background: #ef4444; box-shadow: 0 0 0 3px rgba(239,68,68,.18); }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 18px;
      margin-top: 14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* Cards */
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.035));
      border: 1px solid var(--line);
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-hd{
      padding: 18px 18px 12px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .card-hd h2{
      margin:0;
      font-size: 14px;
      font-weight: 650;
      letter-spacing:.2px;
    }
    .card-hd p{
      margin:6px 0 0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
    }
    .card-bd{ padding: 16px 18px 18px; }

    /* Input */
    .inputRow{
      display:flex;
      gap: 10px;
      margin-top: 12px;
      flex-wrap:wrap;
    }
    .inputRow input{
      flex: 1 1 210px;
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.24);
      color: var(--text);
      outline:none;
    }
    .inputRow input::placeholder{ color: rgba(255,255,255,.40); }
    .btn{
      padding: 13px 16px;
      border-radius: 14px;
      border: 1px solid rgba(199,164,90,.45);
      background: rgba(199,164,90,.14);
      color: rgba(255,255,255,.92);
      font-weight: 700;
      cursor:pointer;
      transition: .18s ease;
      white-space:nowrap;
    }
    .btn:hover{ background: rgba(199,164,90,.20); transform: translateY(-1px); }

    /* Empty state */
    .empty{
      margin-top: 12px;
      padding: 14px 14px;
      border-radius: 16px;
      background: rgba(255,255,255,.035);
      border: 1px dashed rgba(199,164,90,.28);
      color: rgba(255,255,255,.78);
      font-size: 12px;
      line-height: 1.45;
    }

    /* Reserva item */
    .reserva{
      margin-top: 12px;
      padding: 14px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      transition: .2s ease;
    }
    .reserva:hover{
      transform: translateY(-1px);
      border-color: rgba(199,164,90,.35);
      background: rgba(255,255,255,.05);
    }
    .rTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .rTop b{
      font-size: 14px;
      font-weight: 700;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.86);
      white-space:nowrap;
    }
    .badge .miniDot{ width:7px; height:7px; border-radius: 999px; background: rgba(255,255,255,.30); }
    .badge.ok{ background: var(--okbg); border-color: var(--okbd); color: var(--oktx); }
    .badge.ok .miniDot{ background: #22c55e; }
    .badge.pend{ background: var(--pbg); border-color: var(--pbd); color: var(--ptx); }
    .badge.pend .miniDot{ background: #f7c948; }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .chip{
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: rgba(255,255,255,.82);
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      display:inline-flex;
      align-items:center;
      gap: 8px;
    }
    .chip svg{ opacity:.85; }

    .noteLine{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px dashed rgba(199,164,90,.28);
      background: rgba(199,164,90,.06);
      color: rgba(255,255,255,.82);
      font-size: 12px;
      line-height: 1.4;
    }

    .foot{
      margin-top: 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      color: rgba(255,255,255,.50);
      font-size: 11px;
    }
    .foot a{ color: rgba(255,255,255,.60); text-decoration:none; }
    .foot a:hover{ color: rgba(255,255,255,.80); }

    /* Info panel */
    .infoItem{
      padding: 14px 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.035);
      border: 1px solid rgba(255,255,255,.08);
      margin-top: 12px;
    }
    .infoItem h3{
      margin:0 0 8px;
      font-size: 12.5px;
      font-weight: 650;
      color: rgba(199,164,90,.95);
      letter-spacing: .2px;
    }
    .infoItem p{
      margin:0;
      font-size: 12.3px;
      color: rgba(255,255,255,.82);
      line-height: 1.45;
    }
    .fine{
      margin-top: 12px;
      color: rgba(255,255,255,.55);
      font-size: 11.5px;
      line-height: 1.4;
    }

    /* Subtle separator */
    .sep{
      height:1px;
      background: rgba(255,255,255,.08);
      margin: 14px 0 0;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Dog Company — Panel de Cliente</h1>
          <p>Consulta tus reservas con nosotras</p>
        </div>
      </div>
      <div class="pill" id="statusPill"><span class="dot wait" id="statusDot"></span><span id="statusText">Esperando enlace</span></div>
    </div>

    <div class="grid">
      <!-- LEFT: Reservas -->
      <section class="card">
        <div class="card-hd">
          <div>
            <h2>Mis reservas</h2>
            <p>Abre tu enlace personal para ver tu histórico. (Ejemplo: <code>?k=demo123</code>)</p>
          </div>
        </div>

        <div class="card-bd">
          <div id="empty" class="empty" style="display:none;">
            <b>No se ha detectado tu enlace.</b><br/>
            Si estás probando ahora, escribe tu código:
            <div class="inputRow">
              <input id="kInput" placeholder="Ej: demo123" autocomplete="off" />
              <button class="btn" id="btnGo">Ver mis reservas</button>
            </div>
          </div>

          <div id="list"></div>

          <div class="foot">
            <div id="clientLine"></div>
            <div>© Dog Company</div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Info -->
      <aside class="card">
        <div class="card-hd">
          <div>
            <h2>Información</h2>
            <p>Detalles útiles para tu entrada y estancia.</p>
          </div>
        </div>

        <div class="card-bd">
          <div class="infoItem">
            <h3>Punto de encuentro</h3>
            <p>Puerta principal de Renfe. Desde allí damos un paseo corto para observar al perro en entorno neutro.</p>
          </div>

          <div class="infoItem">
            <h3>Adaptación primera vez</h3>
            <p>Recomendamos guardería previa o mínimo 48h antes de estancias largas para que se habitúe al entorno.</p>
          </div>

          <div class="infoItem">
            <h3>Contacto</h3>
            <p>Si necesitas cambiar algo, responde al WhatsApp del que recibiste el enlace.</p>
          </div>

          <div class="sep"></div>
          <div class="fine">
            * Este panel es solo informativo. Las reservas se confirman por WhatsApp.
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    // --- Config ---
    const DATA_URL = "./data.json";

    // --- UI helpers ---
    const $ = (id) => document.getElementById(id);

    function setStatus(kind, text){
      const dot = $("statusDot");
      const pillText = $("statusText");
      dot.className = "dot " + (kind || "wait");
      pillText.textContent = text || "";
    }

    function qs(name){
      const u = new URL(window.location.href);
      return u.searchParams.get(name);
    }

    function esc(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function isoToEU(d){
      // expects YYYY-MM-DD, returns DD/MM/YYYY
      if(!d || !/^\d{4}-\d{2}-\d{2}$/.test(d)) return d || "—";
      const [y,m,dd] = d.split("-");
      return `${dd}/${m}/${y}`;
    }

    function badgeFor(estado){
      const e = (estado || "").toLowerCase();
      if(e === "confirmada") return {cls:"ok", label:"Confirmada"};
      if(e === "pendiente")  return {cls:"pend", label:"Pendiente"};
      // fallback
      return {cls:"", label: estado || "—"};
    }

    function iconCalendar(){
      return `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M7 3v2M17 3v2M4 9h16M6 5h12a2 2 0 0 1 2 2v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z" stroke="rgba(255,255,255,.72)" stroke-width="1.6" stroke-linecap="round"/>
      </svg>`;
    }
    function iconTag(){
      return `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M20 13 11 22 2 13V2h11l7 7Z" stroke="rgba(255,255,255,.72)" stroke-width="1.6" stroke-linejoin="round"/>
        <path d="M7.5 7.5h.01" stroke="rgba(255,255,255,.72)" stroke-width="3" stroke-linecap="round"/>
      </svg>`;
    }

    function render(items, clientName){
      const list = $("list");
      list.innerHTML = "";

      if(!items.length){
        list.innerHTML = `<div class="empty" style="display:block; border-style: solid; border-color: rgba(255,255,255,.08); background: rgba(255,255,255,.03);">
          No encontramos reservas para este enlace.
        </div>`;
        return;
      }

      for(const r of items){
        const b = badgeFor(r.estado);
        const note = r.notas_cliente ? `<div class="noteLine"><b>Nota:</b> ${esc(r.notas_cliente)}</div>` : "";
        const perro = esc(r.perro_nombre || "Reserva");
        const servicio = esc(r.servicio || "—");

        list.innerHTML += `
          <div class="reserva">
            <div class="rTop">
              <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
                <b>${perro}</b>
                <span class="badge ${b.cls}"><span class="miniDot"></span>${esc(b.label)}</span>
              </div>
            </div>

            <div class="chips">
              <span class="chip">${iconCalendar()} ${esc(isoToEU(r.fecha_entrada))} → ${esc(isoToEU(r.fecha_salida))}</span>
              <span class="chip">${iconTag()} ${servicio}</span>
            </div>

            ${note}
          </div>
        `;
      }

      if(clientName){
        $("clientLine").textContent = `Cliente: ${clientName}`;
      }else{
        $("clientLine").textContent = "";
      }
    }

    async function loadData(){
      const res = await fetch(DATA_URL, { cache: "no-store" });
      if(!res.ok) throw new Error("No se pudo cargar data.json");
      const data = await res.json();
      return Array.isArray(data) ? data : [];
    }

    function normalizeKey(s){
      return (s || "").toString().trim();
    }

    async function run(clientKey){
      const key = normalizeKey(clientKey);
      if(!key){
        setStatus("wait", "Esperando enlace");
        $("empty").style.display = "block";
        render([], "");
        return;
      }

      setStatus("wait", "Cargando…");

      try{
        const data = await loadData();
        const rows = data.filter(r => normalizeKey(r.client_key) === key);

        // Orden por entrada asc
        rows.sort((a,b)=> (a.fecha_entrada || "").localeCompare(b.fecha_entrada || ""));

        const clientName = rows.find(r => r.cliente_nombre)?.cliente_nombre || "";
        render(rows, clientName);
        setStatus("ok", "Listo");
        $("empty").style.display = "none";
      }catch(err){
        console.error(err);
        setStatus("err", "Error");
        $("empty").style.display = "block";
        $("list").innerHTML = `<div class="empty" style="display:block; border-color: rgba(239,68,68,.25); background: rgba(239,68,68,.07);">
          No se ha podido cargar el panel. Reintenta en unos segundos.
        </div>`;
      }
    }

    // Init
    (function(){
      const k = qs("k");
      const input = $("kInput");
      const btn = $("btnGo");

      btn.addEventListener("click", ()=> {
        const v = normalizeKey(input.value);
        if(!v) return;
        const u = new URL(window.location.href);
        u.searchParams.set("k", v);
        window.location.href = u.toString();
      });

      if(k){
        input.value = k;
        run(k);
      }else{
        run("");
      }
    })();
  </script>
</body>
</html>

